// Primary database schema - Tenant registry and platform metadata
// This schema is owned by the API Gateway (vritti-api-nexus)

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("PRISMA_CLI_DATABASE_URL")
  directUrl = env("PRISMA_CLI_DIRECT_URL")
}

/// Tenant registry - stores configuration for all tenants
model Tenant {
  id          String       @id @default(uuid())
  subdomain   String       @unique /// Subdomain for tenant access (e.g., 'acme' for acme.yourdomain.com)
  name        String       /// Display name
  description String?      /// Optional description of the tenant

  dbType   DatabaseType @default(SHARED) @map("db_type")
  status   TenantStatus @default(ACTIVE)

  // Database connection details
  // For SHARED: Only dbSchema is typically used (schema within shared database)
  // For DEDICATED: All fields are used for dedicated database connection
  dbHost             String? @map("db_host") /// Database host
  dbPort             Int?    @map("db_port") /// Database port (default: 5432)
  dbUsername         String? @map("db_username") /// Database username (encrypted)
  dbPassword         String? @map("db_password") /// Database password (encrypted)
  dbName             String? @map("db_name") /// Database name
  dbSchema           String? @map("db_schema") /// PostgreSQL schema name
  dbSslMode          String? @default("require") @map("db_ssl_mode") /// SSL mode: require, prefer, disable
  connectionPoolSize Int?    @default(10) @map("connection_pool_size") /// Connection pool size

  // Metadata
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("tenants")
}

enum DatabaseType {
  SHARED    /// Shared database with separate schema per tenant
  DEDICATED /// Dedicated database per tenant
}

enum TenantStatus {
  ACTIVE    /// Tenant is active and can be accessed
  SUSPENDED /// Tenant is temporarily suspended
  ARCHIVED  /// Tenant is archived (soft delete)
}
